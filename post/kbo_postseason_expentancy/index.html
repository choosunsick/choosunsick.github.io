<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>2018년 KBO 가을야구 진출팀은 어떤팀일 것인가 ? - Sunsick&#39;s blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Sunsick" /><meta name="description" content="안녕하세요. 스터디 그룹 LOPES의 추선식입니다. 메이저리그 야구 통계학이라는 책을 공부하는데, 이 책에서 나온 기대 승률(피타고리안 승률)이란 통계적 지" /><meta name="keywords" content="blog, R, Data Analysis" />






<meta name="generator" content="Hugo 0.84.4 with theme even" />


<link rel="canonical" href="https://choosunsick.github.io/post/kbo_postseason_expentancy/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="2018년 KBO 가을야구 진출팀은 어떤팀일 것인가 ?" />
<meta property="og:description" content="안녕하세요. 스터디 그룹 LOPES의 추선식입니다. 메이저리그 야구 통계학이라는 책을 공부하는데, 이 책에서 나온 기대 승률(피타고리안 승률)이란 통계적 지" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://choosunsick.github.io/post/kbo_postseason_expentancy/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2018-07-24T16:53:31+09:00" />
<meta property="article:modified_time" content="2018-07-24T16:53:31+09:00" />

<meta itemprop="name" content="2018년 KBO 가을야구 진출팀은 어떤팀일 것인가 ?">
<meta itemprop="description" content="안녕하세요. 스터디 그룹 LOPES의 추선식입니다. 메이저리그 야구 통계학이라는 책을 공부하는데, 이 책에서 나온 기대 승률(피타고리안 승률)이란 통계적 지"><meta itemprop="datePublished" content="2018-07-24T16:53:31+09:00" />
<meta itemprop="dateModified" content="2018-07-24T16:53:31+09:00" />
<meta itemprop="wordCount" content="8083">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="2018년 KBO 가을야구 진출팀은 어떤팀일 것인가 ?"/>
<meta name="twitter:description" content="안녕하세요. 스터디 그룹 LOPES의 추선식입니다. 메이저리그 야구 통계학이라는 책을 공부하는데, 이 책에서 나온 기대 승률(피타고리안 승률)이란 통계적 지"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Choo&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Choo&#39;s Blog</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">2018년 KBO 가을야구 진출팀은 어떤팀일 것인가 ?</h1>

      <div class="post-meta">
        <span class="post-time"> 2018-07-24 </span>
        
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#기대-승률-및-실제-승률를-비교해-봅시다">기대 승률 및 실제 승률를 비교해 봅시다.</a>
      <ul>
        <li><a href="#2017년-kbo-자료에서-포스트시즌-참가팀-추리기">2017년 KBO 자료에서 포스트시즌 참가팀 추리기</a></li>
        <li><a href="#2017년-포스트시즌-진출팀의-승률-평균-값-구하기">2017년 포스트시즌 진출팀의 승률 평균 값 구하기</a></li>
        <li><a href="#전처리-함수를-적용한-데이터를-가지고-승률-함수에-적용하기">전처리 함수를 적용한 데이터를 가지고 승률 함수에 적용하기</a></li>
        <li><a href="#2018년-전반기-상위팀의-승률과-기대-승률-구하기">2018년 전반기 상위팀의 승률과 기대 승률 구하기</a></li>
        <li><a href="#현재-상위-5개-팀의-2017년도-총득점-총실점-구해보기">현재 상위 5개 팀의 2017년도 총득점, 총실점 구해보기</a></li>
        <li><a href="#결과표">결과표</a></li>
        <li><a href="#결과표2">결과표2</a></li>
        <li><a href="#참고-10개-팀-결과">참고: 10개 팀 결과</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>안녕하세요. 스터디 그룹 LOPES의 추선식입니다. 메이저리그 야구 통계학이라는 책을 공부하는데, 이 책에서 나온 기대 승률(피타고리안 승률)이란 통계적 지표를 KBO 자료에 적용해보았습니다. 이 책에서는 기대 승률을 다음과 같이 설명합니다.</p>
<blockquote>
<p>&lt;머니볼&gt;을 보면 단장역을 맡고 있는 브래드 피트가 분석보좌 역과 함께 복잡하게 숫자가 널려있는 화이트 보드 앞에서 대화를 나누는 장면이 나온다 그 장면에서 사무실 벽에 걸려있는 화이트보드에는 2001년도 아메리칸리그 서부지구에서 오클랜드가 포스트시즌에 진출할 때 보유하고 있던 실제 수치와 그 공식이 첫 번째 행에 나온다.</p>
</blockquote>
<blockquote>
<!-- raw HTML omitted -->
</blockquote>
<blockquote>
<p>884는 2001년도 오클랜드의 실제 팀득점을, 645는 실제 팀실점을 가리키며, 다음 공식에 대입해서 이론 승률을 구했던 것이다. 오클랜드의 2001년 실제승률은 62.96%였으며 공식에 득점과 실점을 투입해서 나오는 0.6525 예측치와 제법 가까운 값이 나왔다. 결국 기대 승률을 예측하는 데 득점과 실점이 중요한 역할을 하기에 역으로 2002년 포스트시즌에 진출할 수 있는 득점과 실점을 계산할 수 있다는 주장이다.</p>
</blockquote>
<blockquote>
<!-- raw HTML omitted -->
</blockquote>
<blockquote>
<p>공식의 왼쪽 항에 있는 분수식을 논리적으로 이해할 필요는 없다. 경험적으로 득점과 실점을 이렇게 구성했을 때 실제 승률과 가장 비슷한 기대 승률이 나왔다는 경험적 발견이기 때문이다.</p>
</blockquote>
<blockquote>
<p>[메이저리그 야구 통계학, 김재민, 에이콘, pp.119 ~ 120]</p>
</blockquote>
<p>2018 KBO 프로야구 시즌은 올스타전이 끝나고 후반기에 돌입하여 가을 야구까지 약 2~3개월이 남은 상태입니다. 많은 사람이 어느 팀이 포스트시즌에 진출해 가을야구를 할 것인지 궁금해할 것입니다. 기대 승률이라는 지표와 실제 승률과 전년도 포스트시즌 진출팀의 평균 승률과 같은 통계적 지표들 간의 비교를 통해 어느 팀이 포스트시즌에 진출할 가능성이 높은지를 살펴보겠습니다.</p>
<h2 id="기대-승률-및-실제-승률를-비교해-봅시다">기대 승률 및 실제 승률를 비교해 봅시다.</h2>
<h3 id="2017년-kbo-자료에서-포스트시즌-참가팀-추리기">2017년 KBO 자료에서 포스트시즌 참가팀 추리기</h3>
<p>우선 2017년 KBO 자료를 R로 읽어오겠습니다. 혹시 더 오래된 KBO 자료가 필요하시면 <a href="https://github.com/choosunsick/KBO_data">https://github.com/choosunsick/KBO_data</a>로 가시면 됩니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">KBO.2017.URL&lt;-&#34;https://lopes.hufs.ac.kr/KBO/KBO_2017_season.csv&#34;
KBO.2017&lt;-read.table(file = KBO.2017.URL, header= TRUE, sep=&#34;,&#34;,stringsAsFactors = FALSE)
</code></pre></td></tr></table>
</div>
</div><p>읽어온 자료에서 정규시즌과 시범경기 올스타전을 제외한 경기만 뽑아줍니다. 이어서 그 자료에서 경기를 한 팀들을 모으고 고유한 팀만 남겨줍니다. 그러면 2017년 포스트시즌에 경기를 했던 팀만 남게됩니다. 아래의 결과를 보시면 &ldquo;NC&rdquo;, &ldquo;롯데&rdquo;, &ldquo;두산&rdquo;,&ldquo;기아&rdquo;, &ldquo;SK&rdquo; 5개 팀을 확인할 수 있습니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">KBO.2017.postseason&lt;-KBO.2017[KBO.2017$비고!=&#34;시범경기&#34;&amp;KBO.2017$비고!=&#34;정규시즌&#34;&amp;KBO.2017$비고!=&#34;올스타전&#34;,]
postseasonteam.2017&lt;-unique(c(KBO.2017.postseason$홈팀,KBO.2017.postseason$원정팀))
postseasonteam.2017
</code></pre></td></tr></table>
</div>
</div><pre><code>## [1] &quot;NC&quot;   &quot;롯데&quot; &quot;두산&quot; &quot;기아&quot; &quot;SK&quot;
</code></pre>
<h3 id="2017년-포스트시즌-진출팀의-승률-평균-값-구하기">2017년 포스트시즌 진출팀의 승률 평균 값 구하기</h3>
<p>이제 위에서 확인한 5개 팀의 승률을 함수를 통해 구할 수 있습니다. 5개 팀의 승률 평균 값을 구하는 이유는 이후 기대 승률 값과 비교를 하기위해서 입니다. 승률을 구하는 과정에서 필요한 함수는 두 가지로 데이터를 전처리하는 함수와 승률을 계산하는 함수입니다. 데이터를 전처리 함수는 데이터, 연도, 팀이름의 3가지 인자를 받는 함수로 연도와 팀이름을 이용해 데이터에서 경기결과를 새롭게 만들어 주는 역할을 합니다.</p>
<p>이 함수의 작동원리는 다음과 같습니다. 먼저 데이터에서 인자로 입력된 팀이 홈팀일 때의 정규시즌 데이터를 뽑아냅니다. 이후 경기연도를 열로 만들어 입력된 년도의 데이터만 뽑아냅니다. 경기결과 열은 홈팀점수와 원정팀점수 간의 비교를 통해 홈팀점수가 더 높으면 승, 낮으면 패, 같으면 무로 나누어 구성해줍니다. 이런 과정을 인자로 받은 팀이 원정팀인 경우에도 똑같이 진행하여 경기결과 열을 만듭니다. 이렇게 만들어진 두 데이터를 다시 합쳐서 반환합니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">data.cleaning &lt;- function(x,y,z){#x=데이터,y=년도,z=팀이름
  teamdata.home&lt;-x[x$홈팀==z &amp; x$비고 ==&#34;정규시즌&#34;,] #
  teamdata.home$경기연도&lt;-substr(teamdata.home$Date,1,4)
  teamdata.home&lt;-teamdata.home[teamdata.home$경기연도==y,]
  teamdata.home$경기결과 &lt;- ifelse(teamdata.home$홈팀점수&gt;teamdata.home$원정팀점수,&#34;승&#34;,
                               ifelse(teamdata.home$홈팀점수&lt;teamdata.home$원정팀점수,&#34;패&#34;,&#34;무&#34;))
  teamdata.away&lt;-x[x$원정팀==z &amp; x$비고 ==&#34;정규시즌&#34;,]
  teamdata.away$경기연도&lt;-substr(teamdata.away$Date,1,4)
  teamdata.away&lt;-teamdata.away[teamdata.away$경기연도==y,]
  teamdata.away$경기결과 &lt;- ifelse(teamdata.away$홈팀점수&gt;teamdata.away$원정팀점수,&#34;패&#34;,
                               ifelse(teamdata.away$홈팀점수&lt;teamdata.away$원정팀점수,&#34;승&#34;,&#34;무&#34;))
  teamdata&lt;-rbind(teamdata.home,teamdata.away)
  teamdata&lt;-teamdata[order(teamdata$Date,decreasing = FALSE),]
  return(teamdata)
}
</code></pre></td></tr></table>
</div>
</div><p><code>head(data.cleaning(KBO.2017,&quot;2017&quot;,&quot;두산&quot;))</code> 로 전처리 함수의 결과를 확인할 수 있습니다.</p>
<h3 id="전처리-함수를-적용한-데이터를-가지고-승률-함수에-적용하기">전처리 함수를 적용한 데이터를 가지고 승률 함수에 적용하기</h3>
<p>전처리 함수로 처리한 데이터를 승률을 구하는 함수에 넣어서 해당 팀의 정규시즌 승, 패, 무, 승률을 계산합니다. 승률 함수는 전처리 함수에서 만든 경기결과 열을 통해 해당 팀의 승리, 패배, 무승부(있는 경우에만)를 가지고 승률 공식에 대입하여 계산하는 역할을 합니다. 현재 적용되는 승률 공식은 승리한 경기 수 + 패배한 경기 수에서 승리한 경기 수로 나누어 주는 것입니다.</p>
<p>이 함수의 인자는 하나로 데이터만 필요로 합니다. 참고로 이 함수에서 데이터가 2010년의 데이터인지 아닌지를 검사하는데, 이는 2010년에는 승률을 구하는 공식이 다르기 때문입니다.</p>
<p>이제 데이터가 2010년이 아닌 경우면 위의 공식으로 계산을 하게됩니다. 그후에 해당 팀의 기록에 무승부가 있는지 없는지를 검사합니다. 이것은 승률 계산시 무승부를 제외하기에 필요한 검사입니다. 이 검사 이후에 무승부가 있는 경우와 없는 경우를 나누어 해당 팀의 승률을 계산해줍니다. 이렇게 계산된 승률은 해당 팀의 승리와 패배, 무승부 기록과 함께 데이터 프레임(data.frame)으로 반환됩니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Yearly.Win.Per &lt;- function(x){#x=data
  if(all(x$경기연도==&#34;2010&#34;)==TRUE){
    if(NROW(table(x$경기결과))&gt;2){
      win.percentage &lt;- table(x$경기결과)[2]/sum(table(x$경기결과))
      result&lt;-data.frame(&#34;승&#34;=table(x$경기결과)[2],&#34;패&#34;=table(x$경기결과)[3],&#34;무&#34;=table(x$경기결과)[1],&#34;승률&#34;=win.percentage,row.names = NULL)
    }
    else{
      win.percentage &lt;- table(x$경기결과)[1]/sum(table(x$경기결과))
      result&lt;-data.frame(&#34;승&#34;=table(x$경기결과)[1],&#34;패&#34;=table(x$경기결과)[2],&#34;무&#34;=&#34;무승부 없음&#34;,&#34;승률&#34;=win.percentage,row.names = NULL,stringsAsFactors = FALSE)
    }
  }
  else{
    if(NROW(table(x$경기결과))&gt;2){
      win.percentage &lt;- table(x$경기결과)[2]/(sum(table(x$경기결과))-table(x$경기결과)[1])
      result&lt;-data.frame(&#34;승&#34;=table(x$경기결과)[2],&#34;패&#34;=table(x$경기결과)[3],&#34;무&#34;=table(x$경기결과)[1],&#34;승률&#34;=win.percentage,row.names = NULL)
    }
    else{
      win.percentage &lt;- table(x$경기결과)[1]/sum(table(x$경기결과))
      result&lt;-data.frame(&#34;승&#34;=table(x$경기결과)[1],&#34;패&#34;=table(x$경기결과)[2],&#34;무&#34;=&#34;무승부 없음&#34;,&#34;승률&#34;=win.percentage,row.names = NULL,stringsAsFactors = FALSE)
    }
  }
  return(result)
}
</code></pre></td></tr></table>
</div>
</div><p>위의 함수를 2017년 두산팀 데이터에 적용해보겠습니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Doosan.win.percentage&lt;-Yearly.Win.Per(data.cleaning(KBO.2017,&#34;2017&#34;,&#34;두산&#34;))
Doosan.win.percentage
</code></pre></td></tr></table>
</div>
</div><pre><code>##   승 패 무      승률
## 1 84 57  3 0.5957447
</code></pre>
<p>이제 같은 방식으로 앞서 구한 전년도 포스트시즌 진출한 (&ldquo;NC&rdquo;,&ldquo;롯데&rdquo;,&ldquo;두산&rdquo;,&ldquo;기아&rdquo;,&ldquo;SK&rdquo;) 5개 팀 모두의 승률을 구해줍니다. 5개 팀의 승률을 구하면 그것의 평균을 구해줍니다. 평균 승률을 구하는 이유는 기대 승률과 비교와 시즌 종료시 포스트시즌 진출에 필요한 득점의 수를 추정하는데 필요하기 때문입니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">fiveteam.win.percentage&lt;-do.call(rbind,lapply(1:5,FUN = function(i){Yearly.Win.Per(data.cleaning(KBO.2017,&#34;2017&#34;,postseasonteam.2017[i]))}))
win.percentage.mean&lt;-mean(fiveteam.win.percentage$승률)
win.percentage.mean
</code></pre></td></tr></table>
</div>
</div><pre><code>## [1] 0.5704552
</code></pre>
<h3 id="2018년-전반기-상위팀의-승률과-기대-승률-구하기">2018년 전반기 상위팀의 승률과 기대 승률 구하기</h3>
<p>이제 작년 포스트시즌 진출팀의 평균 승률을 구했으니 비교할 대상인 현재 시즌에 상위팀 (&ldquo;두산&rdquo;,&ldquo;한화&rdquo;,&ldquo;SK&rdquo;,&ldquo;LG&rdquo;,&ldquo;넥센&rdquo;)의 전반기 승률과 기대 승률을 구해볼 차례입니다. 먼저 2018년 전반기 데이터를 R로 가져옵니다. 2018년 두산팀의 데이터를 예시로 먼저 승률을 구해보았습니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">KBO.2018.half.URL &lt;- &#34;https://lopes.hufs.ac.kr/KBO/KBO_2018_season_half.csv&#34;
KBO.2018.half&lt;-read.table(file = KBO.2018.half.URL, header= TRUE, sep=&#34;,&#34;,stringsAsFactors = FALSE)
Doosan.2018&lt;-data.cleaning(KBO.2018.half,&#34;2018&#34;,&#34;두산&#34;)
Yearly.Win.Per(Doosan.2018)
</code></pre></td></tr></table>
</div>
</div><pre><code>##   승 패          무      승률
## 1 58 29 무승부 없음 0.6666667
</code></pre>
<p>(&ldquo;두산&rdquo;,&ldquo;한화&rdquo;,&ldquo;SK&rdquo;,&ldquo;LG&rdquo;,&ldquo;넥센&rdquo;) 5개 팀의 승률을 구하면 다음과 같습니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Topfive.team.2018&lt;-c(&#34;두산&#34;,&#34;한화&#34;,&#34;SK&#34;,&#34;LG&#34;,&#34;넥센&#34;)
Topfive.team.2018.win.percentage&lt;-do.call(rbind,lapply(1:5,FUN = function(i){Yearly.Win.Per(data.cleaning(KBO.2018.half,&#34;2018&#34;,Topfive.team.2018[i]))}))
row.names(Topfive.team.2018.win.percentage) &lt;- Topfive.team.2018
Topfive.team.2018.win.percentage
</code></pre></td></tr></table>
</div>
</div><pre><code>##      승 패          무      승률
## 두산 58 29 무승부 없음 0.6666667
## 한화 52 37 무승부 없음 0.5842697
## SK   48 37           1 0.5647059
## LG   48 41           1 0.5393258
## 넥센 46 46 무승부 없음 0.5000000
</code></pre>
<p>이제 다른 비교 지표인 기대 승률을 구해보겠습니다. 기대 승률은 함수를 통해 구할 수 있습니다. 이 함수는 데이터와 팀이름을 인자로 받아, 팀이름을 홈팀과 원정팀일 때로 구분하고 각각 득점과 실점의 합을 구하고 그것을 기대 승률 공식에 대입하여 기대 승률, 총득점, 총실점을 반환합니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">pythagorean.expectation&lt;-function(x,y){#x=data,y=teamname
  team.data.home&lt;-x[x$홈팀==y,]
  team.data.away&lt;-x[x$원정팀==y,]
  Runs.score.home &lt;- team.data.home$홈팀점수
  Runs.score.away &lt;- team.data.away$원정팀점수
  Runs.home &lt;- team.data.home$원정팀점수
  Runs.away &lt;- team.data.away$홈팀점수
  Total.Runs.score&lt;-sum(Runs.score.home,Runs.score.away)
  Total.Runs&lt;-sum(Runs.home,Runs.away)
  expectancy.percentage &lt;- Total.Runs.score^2/(Total.Runs^2+Total.Runs.score^2)
  expectancy.table&lt;-data.frame(총득점=Total.Runs.score,총실점=Total.Runs,기대승률=expectancy.percentage)
  return(expectancy.table)
}
</code></pre></td></tr></table>
</div>
</div><h3 id="현재-상위-5개-팀의-2017년도-총득점-총실점-구해보기">현재 상위 5개 팀의 2017년도 총득점, 총실점 구해보기</h3>
<p>이를 구하는 방법은 작년의 데이터를 기대 승률 함수에 적용합니다. 책에서와 같이 여기서 구한 총실점을 이번년도 총실점에도 그러할 것이라 가정합니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">fiveteam.expectation.2017&lt;-do.call(rbind,lapply(1:5,FUN = function(i){pythagorean.expectation(data.cleaning(KBO.2017,&#34;2017&#34;,Topfive.team.2018[i]),Topfive.team.2018[i])}))
row.names(fiveteam.expectation.2017) &lt;-Topfive.team.2018
fiveteam.expectation.2017
</code></pre></td></tr></table>
</div>
</div><pre><code>##      총득점 총실점  기대승률
## 두산    849    678 0.6105973
## 한화    737    820 0.4468434
## SK      761    767 0.4960734
## LG      699    677 0.5159843
## 넥센    789    764 0.5160937
</code></pre>
<p>이제 위에서 적용한 함수를 2018년도 데이터에도 적용해 상위 5개팀의 기대 승률을 구합니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Topfive.team.2018.expectation&lt;-do.call(rbind,lapply(1:5,FUN = function(i){pythagorean.expectation(data.cleaning(KBO.2018.half,&#34;2018&#34;,Topfive.team.2018[i]),Topfive.team.2018[i])}))
row.names(Topfive.team.2018.expectation)&lt;-Topfive.team.2018
Topfive.team.2018.expectation
</code></pre></td></tr></table>
</div>
</div><pre><code>##      총득점 총실점  기대승률
## 두산    555    435 0.6194570
## 한화    438    441 0.4965871
## SK      480    405 0.5841415
## LG      503    458 0.5467238
## 넥센    497    472 0.5257826
</code></pre>
<p>총실점을 전년도 것으로 놓고 전년도 포스트시즌 진출팀의 평균 승률인 57%를 맞추려면 시즌 종료까지 총 몇 득점을 더 해야 하는지 추정해보겠습니다. 추정 방법은 다음과 같이 기대 승률을 구하는 공식을 역추하는 함수를 통해서 득점을 추정하는 것입니다. 즉 전년도 총 실점과 전년도 포스트시즌 진출팀의 평균 승률을 인자로 받으면서 미지수인 총득점의 제곱 값을 <code>sqrt()</code> 함수로 풀어주는 것을 통해 목표득점을 추정해 볼 수 있습니다. 최종적으로는 위에서 구한 현재까지의 총득점과 목표득점 간의 차이를 통해 시즌 끝까지 가을 야구 진출하기위한 평균 승률을 달성하기 위한 요구 득점을 알아낼 수 있습니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Runs.score.estimate&lt;-function(x,y){#x=전년도총실점,y=전년도 포스트시즌진출팀 평균승률
a&lt;-sqrt(y/(1-y)*x^2)
a&lt;-round(a)
return(a)
}
Runs.score.estimate.2018&lt;-Runs.score.estimate(fiveteam.expectation.2017$총실점,win.percentage.mean)
Runs.score.estimate.result&lt;-data.frame(현재득점=Topfive.team.2018.expectation$총득점,목표득점=Runs.score.estimate.2018,요구득점=Runs.score.estimate.2018-Topfive.team.2018.expectation$총득점,row.names = Topfive.team.2018)
Runs.score.estimate.result
</code></pre></td></tr></table>
</div>
</div><pre><code>##      현재득점 목표득점 요구득점
## 두산      555      781      226
## 한화      438      945      507
## SK        480      884      404
## LG        503      780      277
## 넥센      497      880      383
</code></pre>
<p>이렇게 추정한 정보와 더불어 현재 기대 승률과 실제 승률 그리고 전년도 포스트시즌 진출팀의 평균 승률 간의 비교를 통해 상위 5개 팀의 가을 야구 가능성을 점쳐 볼 수 있습니다. 기대 승률과 평균 승률 간 비교하는 열은 전반기까지의 성적만으로도 포스트시즌에 가기에 충분한지 즉 기대 승률이 평균 승률과 같거나 높으면 전반기와 같은 득점과 실점 추세를 유지한다면 충분히 올라갈 수 있다는 의미합니다. 이어서 기대 승률과 실제 승률 간 비교 열은 전반기에 해당팀이 얼마나 전략적으로 잘해왔는지 혹은 운이 좋았는지를 말해줍니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">table.result&lt;-cbind(Topfive.team.2018.win.percentage,Topfive.team.2018.expectation,Runs.score.estimate.result[,2:3],평균승률=win.percentage.mean,기대vs평균=Topfive.team.2018.expectation$기대승률&gt;win.percentage.mean,기대vs실제=Topfive.team.2018.expectation$기대승률&gt;Topfive.team.2018.win.percentage$승률)

table.result
</code></pre></td></tr></table>
</div>
</div><h3 id="결과표">결과표</h3>
<table>
<thead>
<tr>
<th style="text-align:center">이름</th>
<th style="text-align:center">승</th>
<th style="text-align:center">패</th>
<th style="text-align:center">무</th>
<th style="text-align:center">승률</th>
<th style="text-align:center">총득점</th>
<th style="text-align:center">총실점</th>
<th style="text-align:center">기대승률</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">두산</td>
<td style="text-align:center">58</td>
<td style="text-align:center">29</td>
<td style="text-align:center">없음</td>
<td style="text-align:center">0.6666667</td>
<td style="text-align:center">555</td>
<td style="text-align:center">435</td>
<td style="text-align:center">0.6194570</td>
</tr>
<tr>
<td style="text-align:center">한화</td>
<td style="text-align:center">52</td>
<td style="text-align:center">37</td>
<td style="text-align:center">없음</td>
<td style="text-align:center">0.5842697</td>
<td style="text-align:center">438</td>
<td style="text-align:center">441</td>
<td style="text-align:center">0.4965871</td>
</tr>
<tr>
<td style="text-align:center">SK</td>
<td style="text-align:center">48</td>
<td style="text-align:center">37</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0.5647059</td>
<td style="text-align:center">480</td>
<td style="text-align:center">405</td>
<td style="text-align:center">0.5841415</td>
</tr>
<tr>
<td style="text-align:center">LG</td>
<td style="text-align:center">48</td>
<td style="text-align:center">41</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0.5393258</td>
<td style="text-align:center">503</td>
<td style="text-align:center">458</td>
<td style="text-align:center">0.5467238</td>
</tr>
<tr>
<td style="text-align:center">넥센</td>
<td style="text-align:center">46</td>
<td style="text-align:center">46</td>
<td style="text-align:center">없음</td>
<td style="text-align:center">0.5000000</td>
<td style="text-align:center">497</td>
<td style="text-align:center">472</td>
<td style="text-align:center">0.5257826</td>
</tr>
</tbody>
</table>
<h3 id="결과표2">결과표2</h3>
<table>
<thead>
<tr>
<th style="text-align:left">이름</th>
<th style="text-align:center">목표득점</th>
<th style="text-align:center">요구득점</th>
<th style="text-align:center">평균승률</th>
<th style="text-align:center">기대vs평균</th>
<th style="text-align:center">기대vs실제</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">두산</td>
<td style="text-align:center">781</td>
<td style="text-align:center">226</td>
<td style="text-align:center">0.5704552</td>
<td style="text-align:center">TRUE</td>
<td style="text-align:center">FALSE</td>
</tr>
<tr>
<td style="text-align:left">한화</td>
<td style="text-align:center">945</td>
<td style="text-align:center">507</td>
<td style="text-align:center">0.5704552</td>
<td style="text-align:center">FALSE</td>
<td style="text-align:center">FALSE</td>
</tr>
<tr>
<td style="text-align:left">SK</td>
<td style="text-align:center">884</td>
<td style="text-align:center">404</td>
<td style="text-align:center">0.5704552</td>
<td style="text-align:center">TRUE</td>
<td style="text-align:center">TRUE</td>
</tr>
<tr>
<td style="text-align:left">LG</td>
<td style="text-align:center">780</td>
<td style="text-align:center">277</td>
<td style="text-align:center">0.5704552</td>
<td style="text-align:center">FALSE</td>
<td style="text-align:center">TRUE</td>
</tr>
<tr>
<td style="text-align:left">넥센</td>
<td style="text-align:center">880</td>
<td style="text-align:center">383</td>
<td style="text-align:center">0.5704552</td>
<td style="text-align:center">FALSE</td>
<td style="text-align:center">TRUE</td>
</tr>
</tbody>
</table>
<p>위의 표에서 보면 두산과 SK의 현재 기대 승률만이 작년 포스트시즌 진출팀의 평균 승률을 넘고 나머지 팀은 넘지 못하는 것을 알 수 있습니다. 두산은 지금과 같은 추세를 유지한다면 문제없이 가을야구를 하게 될 것입니다. 현재 SK는 기대 승률을 57%로 유지하고 있지만, 아슬아슬하게 유지하고 있기에 득점을 좀 더 늘려야 안정적으로 포스트시즌에 진출할 수 있을 것입니다.</p>
<p>넥센과 LG의 경우에도 득점을 늘리고 실점을 줄여야 안정적으로 57%의 이상의 기대 승률을 달성할 수 있습니다. 물론 LG의 경우 필요로 하는 득점의 수가 그렇게 많지 않은 점을 감안하면 넥센보다는 수월하게 진출할 것입니다.</p>
<p>특이하게도 한화의 경우 현재 2위지만 기대 승률은 49%로 굉장히 낮습니다. 이런 모습의 원인은 한화가 득점보다 실점이 많기 때문입니다. 물론 실제 승률은 높지만, 그것은 전반기에 운이 좋았다라고 말할 수 있습니다. 왜냐하면 득점은 적고 실점이 많은 상태에서 승리가 많은 경우는 적은 점수차로 상대방 팀을 이긴 것이기 때문입니다. 따라서 만약 이러한 추세가 계속될 경우 한화는 실점이 많아지기에 순위가 내려갈 수 있습니다. 즉 한화는 현재 순위를 유지하기 위해서는 요구하는 득점이 가장 많은점을 보아 앞으로 득점력을 많이 올려야 하며 총실점이 총득점보다 많기에 실점 자체를 줄여야 한다고 생각합니다. 그렇지 않으면 한화는 앞으로 현재 순위를 유지하기 힘들 것입니다.</p>
<h3 id="참고-10개-팀-결과">참고: 10개 팀 결과</h3>
<p>다음 코드는 10개의 전체팀 결과를 보여줍니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Allteam&lt;-unique(KBO.2018.half$원정팀)[1:10]

Allteam.win.percentage&lt;-do.call(rbind,lapply(1:10,FUN = function(i){Yearly.Win.Per(data.cleaning(KBO.2018.half,&#34;2018&#34;,Allteam[i]))}))
Allteam.expectation&lt;-do.call(rbind,lapply(1:10,FUN = function(i){pythagorean.expectation(data.cleaning(KBO.2018.half,&#34;2018&#34;,Allteam[i]),Allteam[i])}))
Allteam.expectation.2017&lt;-do.call(rbind,lapply(1:10,FUN = function(i){pythagorean.expectation(data.cleaning(KBO.2017,&#34;2017&#34;,Allteam[i]),Allteam[i])}))

Allteam.Runs.score.estimate.2018&lt;-Runs.score.estimate(Allteam.expectation.2017$총실점,win.percentage.mean)
Allteam.Runs.score.estimate.result&lt;-data.frame(현재득점=Allteam.expectation$총득점,목표득점=Allteam.Runs.score.estimate.2018,요구득점=Allteam.Runs.score.estimate.2018-Allteam.expectation$총득점,row.names = Allteam)

Allteam.table&lt;-cbind(Allteam.win.percentage,Allteam.expectation,Allteam.Runs.score.estimate.result[,2:3],평균승률=win.percentage.mean,기대vs평균=Allteam.expectation$기대승률&gt;win.percentage.mean,기대vs실제=Allteam.expectation$기대승률&gt;Allteam.win.percentage$승률)
row.names(Allteam.table) &lt;- Allteam
Allteam.table&lt;-Allteam.table[order(Allteam.table$승률,decreasing = TRUE),]
Allteam.table
</code></pre></td></tr></table>
</div>
</div><pre><code>##     승 패    무        승률      총득점   총실점   기대승률     목표득점

## 두산 58 29 무승부 없음 0.6666667    555    435  0.6194570      781      
## 한화 52 37 무승부 없음 0.5842697    438    441  0.4965871      945      
## SK  48 37    1     0.5647059    480    405  0.5841415      884      
## LG  48 41    1     0.5393258    503    458  0.5467238      780      
## 넥센 46 46 무승부 없음 0.5000000    497    472  0.5257826      880      
## 기아 40 45 무승부 없음 0.4705882    485    465  0.5210433      856      
## 삼성 39 49    2     0.4431818    464    522  0.4413793     1050      
## 롯데 37 47    2     0.4404762    480    511  0.4687490      808      
## KT  35 50    2     0.4117647    441    486  0.4515704     1010      
## NC  34 56 무승부 없음 0.3777778    364    512  0.3357389      859     

##        요구득점     평균승률      기대vs평균   기대vs실제
## 두산     226      0.5704552       TRUE      FALSE
## 한화     507      0.5704552      FALSE      FALSE
## SK      404      0.5704552       TRUE       TRUE
## LG      277      0.5704552      FALSE       TRUE
## 넥센     383      0.5704552      FALSE       TRUE
## 기아     371      0.5704552      FALSE       TRUE
## 삼성     586      0.5704552      FALSE      FALSE
## 롯데     328      0.5704552      FALSE       TRUE
## KT      569      0.5704552      FALSE       TRUE
## NC      495      0.5704552      FALSE      FALSE
</code></pre>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">Sunsick</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2018-07-24
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      
      <nav class="post-nav">
        <a class="prev" href="/post/korea_stock_introduction/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">한국 주식 자료 소개</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/kbo_update/">
            <span class="next-text nav-default">KBO_update</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://www.google.com/" class="iconfont icon-google" title="google"></a>
      <a href="https://github.com/choosunsick" class="iconfont icon-github" title="github"></a>
  <a href="https://choosunsick.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021<span class="heart"><i class="iconfont icon-heart"></i></span><span>Sunsick</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
